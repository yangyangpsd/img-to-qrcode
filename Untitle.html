<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片转二维码</title>
    <!-- 引入二维码生成库（CDN） -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        body { max-width: 600px; margin: 20px auto; padding: 0 15px; font-family: Arial, sans-serif; }
        .container { text-align: center; }
        #imgUpload { margin: 20px 0; padding: 8px; }
        #imgPreview { max-width: 100%; max-height: 200px; margin: 10px 0; border: 1px solid #eee; display: none; }
        #qrcodeContainer { margin-top: 30px; padding: 15px; border: 1px solid #eee; display: none; }
        button { padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>图片转二维码工具</h1>
        <!-- 图片上传区域 -->
        <input type="file" id="imgUpload" accept="image/*" />
        <!-- 图片预览区域 -->
        <div>
            <p>图片预览：</p>
            <img id="imgPreview" alt="预览图" />
        </div>
        <!-- 生成二维码按钮 -->
        <button id="generateBtn" disabled>生成二维码</button>
        <!-- 二维码显示区域 -->
        <div id="qrcodeContainer">
            <p>生成的二维码（扫码可获取原图片）：</p>
            <canvas id="qrcode"></canvas>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const imgUpload = document.getElementById('imgUpload');
        const imgPreview = document.getElementById('imgPreview');
        const generateBtn = document.getElementById('generateBtn');
        const qrcodeContainer = document.getElementById('qrcodeContainer');
        const qrcodeCanvas = document.getElementById('qrcode');

        // 存储图片的Base64编码
        let imgBase64 = '';

        // 1. 监听图片上传，生成预览和Base64
        imgUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // 验证文件类型（确保是图片）
            if (!file.type.startsWith('image/')) {
                alert('请选择图片文件（如JPG、PNG）！');
                return;
            }

            // 使用FileReader将图片转为Base64
            const reader = new FileReader();
            reader.onload = function(event) {
                // 显示图片预览
                imgPreview.src = event.target.result;
                imgPreview.style.display = 'block';
                // 存储Base64编码（后续生成二维码用）
                imgBase64 = event.target.result;
                // 启用生成按钮
                generateBtn.disabled = false;
            };
            reader.readAsDataURL(file); // 关键：将图片转为DataURL（即Base64）
        });

        // 2. 点击按钮生成二维码
        generateBtn.addEventListener('click', function() {
            if (!imgBase64) return;

            // 生成二维码（核心逻辑）
            QRCode.toCanvas(qrcodeCanvas, imgBase64, {
                width: 256, // 二维码宽度
                margin: 1,  // 二维码边距
                color: {
                    dark: '#000000', // 二维码深色块颜色
                    light: '#ffffff'  // 二维码浅色块颜色
                }
            }, function(error) {
                if (error) {
                    console.error('生成二维码失败：', error);
                    alert('生成二维码出错，请重试！');
                } else {
                    // 显示二维码区域
                    qrcodeContainer.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>